<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
<title>Comparador de imágenes — Ajuste completo + Anotaciones</title>
<style>
  :root{
    --bg:#0b0f14; --panel:#111826; --ink:#e6eef7; --muted:#9fb3c9; --accent:#6ab0ff;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial}
  .wrap{display:grid;grid-template-columns:320px 1fr;min-height:100vh}
  @media (max-width:960px){.wrap{grid-template-columns:1fr;grid-template-rows:auto 1fr}}
  aside{background:var(--panel);padding:14px;display:flex;flex-direction:column;gap:12px;border-right:1px solid rgba(255,255,255,.06)}
  main{position:relative;overflow:auto;display:flex;align-items:center;justify-content:center}
  canvas{background:#000;max-width:100%;height:auto;border-radius:8px}
  input[type="range"],input[type="file"],button{width:100%}
  button{padding:6px 10px;border:none;border-radius:6px;background:var(--accent);color:#fff;cursor:pointer}
  button:hover{opacity:0.9}
</style>
</head>
<body>
<div class="wrap">
  <aside>
    <h2>Comparador de imágenes</h2>
    <p>Sube dos imágenes (Base y Overlay). Se ajustarán automáticamente al tamaño del lienzo.</p>
    <label>Imagen base:<input id="baseFile" type="file" accept="image/*"></label>
    <label>Imagen overlay:<input id="overlayFile" type="file" accept="image/*"></label>
    <label>Transparencia overlay:<input id="opacity" type="range" min="0" max="1" step="0.01" value="0.5"></label>
    <label>Escala overlay:<input id="scale" type="range" min="0.1" max="4" step="0.01" value="1"></label>
    <button id="center">Centrar</button>
    <button id="download">Descargar PNG</button>
  </aside>
  <main>
    <canvas id="canvas" width="1200" height="1600"></canvas>
  </main>
</div>
<script>
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
const baseFile=document.getElementById('baseFile');
const overlayFile=document.getElementById('overlayFile');
const opacity=document.getElementById('opacity');
const scale=document.getElementById('scale');
const center=document.getElementById('center');
const download=document.getElementById('download');
let baseImg=null,overlayImg=null,overlayPos={x:canvas.width/2,y:canvas.height/2,scale:1};

function fitImage(img,maxW,maxH){
  const ratio=Math.min(maxW/img.width,maxH/img.height);
  return {w:img.width*ratio,h:img.height*ratio};
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(baseImg){
    const {w,h}=fitImage(baseImg,canvas.width,canvas.height);
    ctx.drawImage(baseImg,(canvas.width-w)/2,(canvas.height-h)/2,w,h);
  }
  if(overlayImg){
    const {w,h}=fitImage(overlayImg,canvas.width,canvas.height);
    ctx.globalAlpha=parseFloat(opacity.value);
    ctx.drawImage(overlayImg,overlayPos.x-w/2*overlayPos.scale,overlayPos.y-h/2*overlayPos.scale,w*overlayPos.scale,h*overlayPos.scale);
    ctx.globalAlpha=1;
  }
}

baseFile.onchange=e=>{
  const file=e.target.files[0];
  if(!file)return;
  const img=new Image();
  img.onload=()=>{baseImg=img;draw();};
  img.src=URL.createObjectURL(file);
};
overlayFile.onchange=e=>{
  const file=e.target.files[0];
  if(!file)return;
  const img=new Image();
  img.onload=()=>{overlayImg=img;draw();};
  img.src=URL.createObjectURL(file);
};

opacity.oninput=draw;
scale.oninput=()=>{overlayPos.scale=parseFloat(scale.value);draw();};

let dragging=false,offX=0,offY=0;
canvas.onpointerdown=e=>{dragging=true;offX=e.offsetX-overlayPos.x;offY=e.offsetY-overlayPos.y;};
canvas.onpointermove=e=>{if(dragging){overlayPos.x=e.offsetX-offX;overlayPos.y=e.offsetY-offY;draw();}};
canvas.onpointerup=()=>dragging=false;
center.onclick=()=>{overlayPos.x=canvas.width/2;overlayPos.y=canvas.height/2;overlayPos.scale=1;scale.value=1;draw();};
download.onclick=()=>{const link=document.createElement('a');link.download='comparacion.png';link.href=canvas.toDataURL('image/png');link.click();};
</script>
</body>
</html>
